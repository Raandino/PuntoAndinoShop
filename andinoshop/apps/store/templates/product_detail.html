{% extends 'base.html' %}

{% block title %}{{ product.name }} | {% endblock %}

{% block content %}
<div class="pt-2 px-md-4 mb-3 bg-white border-bottom shadow-sm" id="search-query">
   
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb" style="background-color: white;">
            <li class="breadcrumb-item"><a href="{% url 'frontpage' %}" style="color: black;">Inicio</a></li>
            {% if product.category.parent %}
                <li class="breadcrumb-item" ><a href="{% url 'category_detail' product.category.parent.slug %}" style="color: black;">{{product.category.parent.title}}</a></li>
            {% endif %}
                <li class="breadcrumb-item " ><a href="{% url 'category_detail' product.category.slug %}" style="color: black;">{{product.category.title}}</a></li>
        </ol>
 
    </nav>
</div>
<div id="productapp">
    <div class="container">
    <div class="row">
        <div class="col-md-6">
            <div class="row no-gutters  overflow-hidden flex-md-row mb-4 position-relative">
            <div class="col p-4 d-flex flex-column position-static">
                <img id="featured" :src="mainImage" alt="">
            <div id="slide-wrapper">
                <div id="slider">
                    <div  v-for="image in images">
                        <figure style="cursor: pointer" class="thumbnail">
                            <img :src="image.thumbnail" @click="changeMainImage(image.image)" class="thumbnail" alt="">
                        </figure>
                    </div>
                </div>
            </div>
        </div>
        </div>
        </div>

        <div class="col-md-6 my-auto">
            <h6>{{product.brand}}</h6>
        <h1>{{product.name}}</h1>
        <h5>Puntuacion: {% if product.get_rating == 0 %}No hay reviews{% else %} {{ product.get_rating|floatformat:1 }} {% endif %}</h5>

        <hr>
        <h3> {% if product.disccount_price %}
            <del style="color: grey;">C${{ product.price }}</del>
            C${{ product.disccount_price }}
        {% else %}
        C${{ product.price }}
        {% endif %}</h3>
        <p>{{product.description}}</p>
        <form class="form-inline">
        <a href="{{ product.get_add_to_cart_url }}" class="btn btn-success mb-2">Añadir al carrito</a>
    </form>
        </div>
    </div>

    <h2>Productos relacionados</h2>
    {% for related_product in related_products %}
    <div class=" col">
        <img src="{{ related_product.thumbnail.url }}" class="rounded mx-auto d-block " alt="">
       <div class="box-element">
           
           <h6 class="text-center">{{related_product.name}}</h6>
           <h6>Puntuacion: {% if related_product.get_rating == 0 %}No hay reviews{% else %} {{ related_product.get_rating|floatformat:1 }} {% endif %}</h6>
           <hr>
           <a class="btn btn-sm btn-outline-info add-btn" href="{% url 'product_detail' related_product.category.slug related_product.slug %}">Ver mas</a>
           <p class="float-right"> 
               {% if related_product.disccount_price %}
            <del style="color: grey;">C${{ related_product.price }}</del>
           <span>C${{ related_product.disccount_price }}</span> 
        {% else %}
       C${{ related_product.price }}
        {% endif %}</p>
       </div>

    </div>
    {% endfor %} 

    <h2>Reseñas</h2>

    <div>
        {% for review in product.reviews.all %}
            <div>
                <p>
                    <strong>Fecha: </strong>{{ review.date_added|date:"Y-m-d"}},
                    <strong>Puntuacion: </strong>{{ review.stars }}
                </p>

                    {{ review.content }}
            </div>

            {% empty %}
            <div>
                No hay reseñas todavia
            </div>
        {% endfor %}
    </div>

    <div>
        {% if request.user.is_authenticated %}
            <form action="" method="POST">
                {% csrf_token %}

                <div class="form-group">
                    <label for="">Estrellas</label>
                    <select name="stars" id="" class="form-control">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3" selected>3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="">Contenido</label>
                    <textarea class="form-control" name="content" id=""></textarea>
                </div>

                <button type="submit" class="btn btn-primary">Enviar</button>
            </form>

            {% else %}
                <p>Inicia Sesion para poder mandar una review</p>

        {% endif %}
    </div>

    


</div>

</div>
{% endblock %}

{% block scripts %}
<script>
    var productapp = new Vue({
        el: '#productapp',
        delimeters: ['[[', ']]'],
        data (){
            return{
                showMessage: false,
                mainImage: '{{ product.image.url }}',
                images: [{{ imagesstring|safe }}]
            }
        },
        mounted(){

        },
        methods:{
            changeMainImage(image){
                this.mainImage = image;
            }
        }
    });

</script>
{% endblock %}